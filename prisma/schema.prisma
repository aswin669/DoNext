generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String            @id @default(cuid())
  email            String            @unique
  name             String?
  password         String
  profilePicture   String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  theme            String            @default("light")
  notifEmail       Boolean           @default(true)
  notifPush        Boolean           @default(true)
  defaultView      String            @default("Dashboard Overview")
  resetToken       String?
  resetTokenExpiry DateTime?
  habits           Habit[]
  notifications    Notification[]
  routineSteps     RoutineStep[]
  tasks            Task[]
  trades           Trade[]
}

model Task {
  id            String           @id @default(cuid())
  title         String
  description   String?
  completed     Boolean          @default(false)
  priority      String           @default("Medium")
  category      String?
  type          String?
  date          DateTime?
  time          String?
  location      String?
  estimatedTime Int?
  actualTime    Int?
  deadline      DateTime?
  userId        String
  parentTaskId  String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  parentTask    Task?            @relation("TaskSubtasks", fields: [parentTaskId], references: [id])
  subtasks      Task[]           @relation("TaskSubtasks")
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  dependents    TaskDependency[] @relation("DependencyTask")
  dependencies  TaskDependency[] @relation("DependentTask")
}

model Habit {
  id           String            @id @default(cuid())
  name         String
  icon         String            @default("ðŸ§˜")
  category     String
  frequency    String
  goalValue    Int
  goalUnit     String
  reminderTime String?
  motivation   String?
  userId       String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  completions  HabitCompletion[]
}

model HabitCompletion {
  id        String   @id @default(cuid())
  date      DateTime
  habitId   String
  createdAt DateTime @default(now())
  habit     Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
}

model RoutineStep {
  id          String              @id @default(cuid())
  time        String
  task        String
  icon        String
  category    String
  active      Boolean             @default(true)
  userId      String
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  completions RoutineCompletion[]
  user        User                @relation(fields: [userId], references: [id])
}

model RoutineCompletion {
  id            String      @id @default(cuid())
  date          DateTime
  routineStepId String
  createdAt     DateTime    @default(now())
  routineStep   RoutineStep @relation(fields: [routineStepId], references: [id], onDelete: Cascade)
}

model Notification {
  id        String   @id @default(cuid())
  title     String
  message   String
  type      String   @default("info")
  read      Boolean  @default(false)
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model TaskDependency {
  id           String   @id @default(cuid())
  dependencyId String
  dependentId  String
  createdAt    DateTime @default(now())
  dependency   Task     @relation("DependencyTask", fields: [dependencyId], references: [id], onDelete: Cascade)
  dependent    Task     @relation("DependentTask", fields: [dependentId], references: [id], onDelete: Cascade)

  @@unique([dependencyId, dependentId])
}

model Trade {
  id                String    @id @default(cuid())
  userId            String
  symbol            String
  tradeType         String // Long or Short
  entryPrice        Float
  stopLoss          Float
  target            Float
  quantity          Float
  riskAmount        Float
  rewardAmount      Float
  riskRewardRatio   Float
  priority          String    @default("Medium")
  strategy          String?
  notes             String?
  status            String    @default("Planned") // Planned, Executed, Completed, Cancelled
  executedAt        DateTime?
  completedAt       DateTime?
  exitPrice         Float?
  profitLoss        Float?
  profitLossPercent Float?
  entryImage        String? // URL to entry screenshot
  exitImage         String? // URL to exit screenshot
  journalEntry      String? // Trade journal notes
  emotion           String? // Confident, Anxious, Neutral, Frustrated
  mistakes          String?
  lessons           String?
  improvements      String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}
